version: '3'
services:

  portainer:
    image: portainer/portainer:linux-arm@sha256:7aa9d50dfebcc84a356c29955068efabd114891b61d8c9982cd1f62b057fd15f686e60d4cab2cd30f623ceec8fb205a7d20b9f2ebbc265b992891c20283b50fd
    container_name: portainer
    command: ["--host=unix:///var/run/docker.sock", "--no-auth"]
    restart: always
    network_mode: "host"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  watchtower:
    image: v2tec/watchtower:armhf-latest@sha256:b74a792de471c9652fb9456071f207eec88cd39dfb17d883d9b755ade5a40d24
    container_name: watchtower
    command: ["--cleanup"]
    restart: on-failure
    network_mode: "host"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  dashboard:
    image: duckietown/dt-duckiebot-dashboard@sha256:3853d6c4ebf8ef0cb4cb5ab6a2632dacb022b608731775818ec9f8b5b1e714d1
    container_name: duckiebot-dashboard
    restart: always
    network_mode: "host"
    volumes:
      - compose-data:/var/www/html
      # cloud-init userdata file
      - /boot/user-data:/robot/boot/user-data
      # raspberry configuration
      - /boot/config.txt:/robot/boot/config.txt
      # info about the underlying OS (read-only)
      - /boot/os-release:/robot/boot/os-release:ro
      # stuff written by init_sd_card
      - /var/local:/robot/var/local
      # generic duckietown data
      - /data:/robot/data
      # avahi services
      - /etc/avahi/services:/etc/avahi/services
      # docker socket
      - /var/run/docker.sock:/var/run/docker.sock

  dt-device-loader:
    image: duckietown/dt-device-loader:daffy-arm32v7@sha256:b6a91064fb15390c659029496e807ea6c93a8e9b3834c96a2c615f455d7578aa
    container_name: device-loader
    restart: on-failure
    network_mode: "host"
    environment:
      - EXCLUDE_RUN=DT18_00_basic
    volumes:
      # docker socket
      - /var/run/docker.sock:/var/run/docker.sock
      # avahi services
      - /etc/avahi/services:/etc/avahi/services
      # duckietown data
      - /data:/data
      - /secrets:/secrets
      - /var/local:/var/local

volumes:
  compose-data:
